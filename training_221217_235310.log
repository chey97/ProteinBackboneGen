INFO:root:Writing training args to /home/kihara/cgalkadu/foldingdiff/results/training_args.json
INFO:root:Training argument: results_dir=/home/kihara/cgalkadu/foldingdiff/results
INFO:root:Training argument: dataset_key=cath
INFO:root:Training argument: angles_definitions=canonical-full-angles
INFO:root:Training argument: max_seq_len=128
INFO:root:Training argument: min_seq_len=40
INFO:root:Training argument: trim_strategy=randomcrop
INFO:root:Training argument: timesteps=1000
INFO:root:Training argument: variance_schedule=cosine
INFO:root:Training argument: variance_scale=1.0
INFO:root:Training argument: time_encoding=gaussian_fourier
INFO:root:Training argument: num_hidden_layers=12
INFO:root:Training argument: hidden_size=384
INFO:root:Training argument: intermediate_size=768
INFO:root:Training argument: num_heads=12
INFO:root:Training argument: position_embedding_type=relative_key
INFO:root:Training argument: dropout_p=0.1
INFO:root:Training argument: decoder=mlp
INFO:root:Training argument: gradient_clip=1.0
INFO:root:Training argument: batch_size=64
INFO:root:Training argument: lr=5e-05
INFO:root:Training argument: loss=smooth_l1
INFO:root:Training argument: use_pdist_loss=0.0
INFO:root:Training argument: l2_norm=0.0
INFO:root:Training argument: l1_norm=0.0
INFO:root:Training argument: circle_reg=0.0
INFO:root:Training argument: min_epochs=10000
INFO:root:Training argument: max_epochs=10000
INFO:root:Training argument: early_stop_patience=0
INFO:root:Training argument: lr_scheduler=LinearWarmup
INFO:root:Training argument: use_swa=False
INFO:root:Training argument: subset=None
INFO:root:Training argument: exhaustive_validation_t=False
INFO:root:Training argument: syn_noiser=
INFO:root:Training argument: single_angle_debug=-1
INFO:root:Training argument: single_timestep_debug=False
INFO:root:Training argument: cpu_only=False
INFO:root:Training argument: ngpu=-1
INFO:root:Training argument: write_valid_preds=False
INFO:root:Training argument: dryrun=False
INFO:root:Training argument: multithread=True
INFO:root:Clean dataset class: <class 'foldingdiff.datasets.CathCanonicalAnglesOnlyDataset'>
INFO:root:Creating data splits: ['train', 'validation', 'test']
INFO:root:Loading cached full dataset from /home/kihara/cgalkadu/foldingdiff/foldingdiff/cache_canonical_structures_cath_1594d9a300ac8d620483f058415b74c7.pkl
WARNING:root:Mismatched hashes between codebase and cached values; updating cached values
INFO:root:Computing full dataset of 31885 with 8 threads
WARNING:root:Illegal values for omega in /home/kihara/cgalkadu/foldingdiff/data/cath/dompdb/5a2qw00 -- skipping
WARNING:root:Illegal values for omega in /home/kihara/cgalkadu/foldingdiff/data/cath/dompdb/2ebqA00 -- skipping
WARNING:root:Illegal values for omega in /home/kihara/cgalkadu/foldingdiff/data/cath/dompdb/1x5bA01 -- skipping
WARNING:root:Illegal values for psi in /home/kihara/cgalkadu/foldingdiff/data/cath/dompdb/1awoA00 -- skipping
INFO:root:Saving full dataset to cache at /home/kihara/cgalkadu/foldingdiff/foldingdiff/cache_canonical_structures_cath_1594d9a300ac8d620483f058415b74c7.pkl
INFO:root:Removing structures shorter than 40 residues excludes 536/30931 --> 30395 sequences
INFO:root:Split train contains 24316 structures
INFO:root:Offsetting features ['phi', 'psi', 'omega', 'tau', 'CA:C:1N', 'C:1N:1CA'] by means [ 1.3270776  1.4532967  1.5187805 -1.4707634  0.0372179  3.127618
  1.9405223  2.0353627  2.122601 ]
INFO:root:Length of angles: 40-1202, mean 153.1534380654713
INFO:root:CATH canonical angles only dataset with ['phi', 'psi', 'omega', 'tau', 'CA:C:1N', 'C:1N:1CA'] (subset idx [3, 4, 5, 6, 7, 8])
INFO:root:Loading cached full dataset from /home/kihara/cgalkadu/foldingdiff/foldingdiff/cache_canonical_structures_cath_1594d9a300ac8d620483f058415b74c7.pkl
INFO:root:Hash matches between codebase and cached values!
INFO:root:Removing structures shorter than 40 residues excludes 536/30931 --> 30395 sequences
INFO:root:Split validation contains 3039 structures
INFO:root:Offsetting features ['phi', 'psi', 'omega', 'tau', 'CA:C:1N', 'C:1N:1CA'] by means [ 1.3272761   1.453351    1.5188463  -1.4752941   0.07301617  3.1281178
  1.9403243   2.0353866   2.1226134 ]
INFO:root:Length of angles: 40-869, mean 154.55248436985852
INFO:root:CATH canonical angles only dataset with ['phi', 'psi', 'omega', 'tau', 'CA:C:1N', 'C:1N:1CA'] (subset idx [3, 4, 5, 6, 7, 8])
INFO:root:Loading cached full dataset from /home/kihara/cgalkadu/foldingdiff/foldingdiff/cache_canonical_structures_cath_1594d9a300ac8d620483f058415b74c7.pkl
INFO:root:Hash matches between codebase and cached values!
INFO:root:Removing structures shorter than 40 residues excludes 536/30931 --> 30395 sequences
INFO:root:Split test contains 3040 structures
INFO:root:Offsetting features ['phi', 'psi', 'omega', 'tau', 'CA:C:1N', 'C:1N:1CA'] by means [ 1.3273247   1.4533684   1.5188134  -1.4690427   0.03956273  3.127477
  1.940246    2.0355554   2.1222587 ]
INFO:root:Length of angles: 40-873, mean 153.78815789473686
INFO:root:CATH canonical angles only dataset with ['phi', 'psi', 'omega', 'tau', 'CA:C:1N', 'C:1N:1CA'] (subset idx [3, 4, 5, 6, 7, 8])
INFO:root:Updating valid/test mean offset to [ 1.3270776  1.4532967  1.5187805 -1.4707634  0.0372179  3.127618
  1.9405223  2.0353627  2.122601 ]
INFO:root:Using <class 'foldingdiff.datasets.NoisedAnglesDataset'> for noise
INFO:root:Getting cosine variance schedule with 1000 timesteps
INFO:root:Getting cosine variance schedule with 1000 timesteps
INFO:root:Getting cosine variance schedule with 1000 timesteps
INFO:root:train: NoisedAnglesDataset wrapping <foldingdiff.datasets.CathCanonicalAnglesOnlyDataset object at 0x7fc84048abe0> with 24316 examples with cosine-1000 with variance scales 1.0 and 1.0
INFO:root:validation: NoisedAnglesDataset wrapping <foldingdiff.datasets.CathCanonicalAnglesOnlyDataset object at 0x7fc84046a9a0> with 3039 examples with cosine-1000 with variance scales 1.0 and 1.0
INFO:root:test: NoisedAnglesDataset wrapping <foldingdiff.datasets.CathCanonicalAnglesOnlyDataset object at 0x7fc84045c9d0> with 3040 examples with cosine-1000 with variance scales 1.0 and 1.0
INFO:root:Computing KL divergence for 1000 timesteps using 8 workers
INFO:root:Plotting distributions at [0, 100, 200, 300, 400, 500, 600, 700, 800, 900, 999] to /home/kihara/cgalkadu/foldingdiff/results/plots
INFO:root:Using loss function: smooth_l1
INFO:root:Auto detected 6 inputs
INFO:torch.distributed.nn.jit.instantiator:Created a temporary directory at /tmp/tmp1dfrp0o2
INFO:torch.distributed.nn.jit.instantiator:Writing /tmp/tmp1dfrp0o2/_remote_module_non_scriptable.py
INFO:root:Mapping loss smooth_l1 to list of losses corresponding to angular [True, True, True, True, True, True]
INFO:root:Model callbacks: [<pytorch_lightning.callbacks.model_checkpoint.ModelCheckpoint object at 0x7fc81f0398e0>, <pytorch_lightning.callbacks.model_checkpoint.ModelCheckpoint object at 0x7fc82e00af10>, <pytorch_lightning.callbacks.lr_monitor.LearningRateMonitor object at 0x7fc81f0392e0>]
INFO:root:Using cuda with strategy <pytorch_lightning.strategies.ddp.DDPStrategy object at 0x7fc805668490>
INFO:torch.distributed.distributed_c10d:Added key: store_based_barrier_key:1 to store for rank: 0
INFO:torch.distributed.distributed_c10d:Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 2 nodes.
INFO:torch.nn.parallel.distributed:Reducer buckets have been rebuilt in this iteration.
